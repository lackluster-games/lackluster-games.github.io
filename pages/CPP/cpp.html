<!DOCTYPE HTML>
<html lang="en">
  <head>
	<title>Getting started With the C preprocessor</title>
		<meta charset="UTF-8">
		<meta content="introduction to C preprocessor" name="description">
	    <meta content="C,Preprocessor,tutorial,how to,how-to" name="keywords">
	    <meta content="Chris Nichols" name="author">
        <link id="css_file" type="text/css" rel="stylesheet" href="../stylesheet/style.css"> 

  </head>
  <!--header for page -->
  <nav id="Page_header" class="Page_header">
      <header>
		  <a id="homepage" rel="external" href="https://www.lacklustergames.xyz"><h1>LackLuster Games</h1></a>
          </header>
	<p>A most excellent website about amateur programming and game development.</p>
  </nav>

  <!-- Main section of blog. -->
  <main  class="Main">
	<div class="Main_Section">
      <section id="introduction">
          <header>
              <h2>Introduction</h2>
          </header>
          <p>
              Welcome to my blog post exploring the basics of the C preprocessor.<br >
              The C preprocessor is a macro processor which is used as part of the process of compiling C source code.<br >
              Macros are widely used when doing C programming, and a knowledge of how to use the C preprocessor will help you be a better C programmer.<br >
              All example code was testing used both GCC and Clang running on manjaro linux. Results may vary on other compilers and/or O.S.<br >
              From here on the C preprocessors will be abbreviated as 'CPP'
          </p>
      </section>
      <section id="basics">
        <br>
          <header>
              <h2>Basics</h2>
          </header>
          <p>
            This first example will illustrate the very basics of macros.<br >
            This example has the preprocessor include a file, and also define two macros.
          </p>
          <ul>
			  <li><code>#include <filename></code> this has CPP include the contents of <em>filename</em> into the current file.</li>
				  <li><code>#define macro body </code> The CPP replaces all occurrences of <em>macro</em> with <em>body</em></li>
          </ul>
          <p>
              In the follow example, we include <em>stdio.h</em> header into our file so that we have access to <code>printf()</code>. <br>
              We also define a macro for <em>PI</em> which expands out into <em>3.14159</em> and a macro called <em>str</em>.<br>
              The code then shows a few examples of these macros being used. Nothing fancy or complicated but i think you get the idea.
          </p>
          <figure id="example_1">
<img alt="" border="0" data-original-height="211" data-original-width="719" width="640" src="./img/ex1.png"/>
            <figcaption>Macros in C. <a rel="external" target="_blank" href="https://github.com/lackluster-games/cpp/blob/master/example1.c">code</a></figcaption>
          </figure>
      </section>
      <section id="functions">
        <br>
          <header>
              <h2>Function like macros</h2>
          </header>
          <p>
            We now move on to function like macros.<br>
            These are macros that we can use like functions.
          </p>
          <ul>
              <li><code>#define name(args) body</code> defining a function like macro which can accept arguments.</li>
          </ul>
          <p>
            To call a function like macro is very similar to calling a normal C function.
          </p>
          <ul>
              <li><code>name(args)</code> calls a function like macro <em>name</em> with args.</li>
          </ul>
          <p>
            In the example code, we create a function like macro which takes in a number and returns the square of it.
          </p>
          <figure id="function_macros">
<img alt="" border="0" data-original-height="210" data-original-width="870" width="640" src="./img/ex2.png"/>
              <figcaption>Function like macros in C. <a rel="external" target="_blank" href="https://github.com/lackluster-games/cpp/blob/master/example2.c">code</a></figcaption>
          </figure>
      </section>
      <section id="files">
        <br>
          <header>
              <h2>External files</h2>
          </header>
          <p>
            This example we cover defining macros in another file and then using them in our current file.<br>
            We first define them in a file <em>macros.h</em> then include that in our file.<br>
            We can then use those macros in the current file just as before.
          </p>
          <ul>
              <li><code>#define "file"</code> search for <em>file</em> in same directory as current file then include it into our current file.</li>
          </ul>
          <figure id="external_macros">
<img alt="" border="0" data-original-height="196" data-original-width="738" width="640" src="./img/ex3.png"/>
              <figcaption>Defining macros in an external file. <a rel="external" target="_blank" href="https://github.com/lackluster-games/cpp/blob/master/example3.c">code</a></figcaption>
          </figure>
          <figure id="macro_file">
<img alt="" border="0" data-original-height="99" data-original-width="751" width="640" src="./img/macroh.png"/>
              <figcaption>External macros in <em>macros.h</em>. <a rel="external" target="_blank" href="https://github.com/lackluster-games/cpp/blob/master/macros.h">code</a></figcaption>
          </figure>
      </section>
      <section id="conditional">
        <br>
          <header>
              <h2>Conditional processing</h2>
          </header>
          <p>
            We can use <em>if</em> like statements to conditionally control the CPP.<br>
            Depending on whether the conditions are true or false we can control how certain macros are handled or even if they exist in the file at all.<br>
            If you already understand if statements as they are regularly used in programming then this should be easy to understand. 
          </p>
          <ul>
              <li><code>#if</code> simple <em>if</em> statement. Checks for true/false</li>
              <li><code>#elif</code>same as an <em>else if</em>.</li> 
              <li><code>#else</code>an <em>else</em> statement</li>
              <li><code>#ifdef</code>if defined. Checks if a macro is defined, and if is, returns true,otherwise returns false.</li>
              <li><code>#ifndef</code>if not defined. Checks to see if a macro is not defined.</li>
              <li><code>#endif</code>Ends a <em>if</em> block.</li>
          </ul>
          <p>
            In the example code we first create two macros to use.<br>
            We then use conditionals to conditionally define other macros which we then use in <code>main()</code><br>
            In our code we also introduce <code>#undef</code> which undefines a macro.<br>
            try commenting out <code>#undef X</code> and also try defining a macro <em>'A'</em> to see how this affects the output.
          </p> 
          <figure id="conditonal_processing">
<img alt="" border="0" data-original-height="578" data-original-width="634" src="./img/ex4.png"/>
              <figcaption>Conditional processing in C. <a rel="external" target="_blank" href="https://github.com/lackluster-games/cpp/blob/master/example4.c">code</a></figcaption>
          </figure>
      </section>
      <section id="predefined">
        <br>
          <header>
              <h2>Predefined macros</h2>
          </header>
          <p>
            In this example I cover some common predefined macros.<br>
            These are macros which the complier already defines.<br>
            Some Caution, not every single one of these may be included in every single C compiler.
          </p>
          <ul>
              <li><code>__FILE__</code> returns the name of the file.</li>
              <li><code>__LINE__</code> returns the line number.</li>
              <li><code>__COUNTER__</code> a counter which starts at zero and increments by 1 on each call.</li>
              <li><code>__func__</code> returns the name of the function it is inside of.</li>
              <li><code>__DATE__</code> returns the current date.</li>
              <li><code>__TIME__</code> returns the time at which the CPP started running.</li>
          </ul>
          <figure id="predefined_macros">
<img alt="" border="0" data-original-height="386" data-original-width="689" width="640" src="./img/ex5.png"/>
              <figcaption>Predefined macros in C. <a rel="external" target="_blank" href="https://github.com/lackluster-games/cpp/blob/master/example5.c">code</a></figcaption>
          </figure>
      </section>
      <section id="debug">
        <br>
          <header>
              <h2>Debugging using the CPP</h2>
          </header>
          <p>
            This example will show a simple way to turn on/off debugging messages using conditionals and the CPP.<br>
            When DEBUG is defined as 1 and/or DEBUG_ALT is defined, debug messages get printed to STDERR.<br>
            Also shown is how to use a conditional to turn off a block of code without needing to delete it all or comment it all out.
          </p>
          <figure id="debug">
<img alt="" border="0" data-original-height="513" data-original-width="780" width="640" src="./img/ex6.png"/>
              <figcaption>Debugging using conditionals with the CPP. <a rel="external" target="_blank" href="https://github.com/lackluster-games/cpp/blob/master/example6.c">code</a></figcaption>
          </figure>
      </section>
      <section id="VA">
        <br>
          <header>
              <h2>Macros with variable arguments</h2>
          </header>
          <p>
            In this example we improve on our debugging by introducing variadic macros<br>
            These are macros which can take in a variable number of arguments.<br>
            We use them to handle the multiple arguments to a call to <em>frpintf()</em>
          </p>
          <ul>
              <li><code>#define macro(...) body</code>
               <ul>
                   <li><code>(...)</code> this indicates that the macro can take variable arguments.</li>
                    <li><code>__VA_ARGS__</code> This represent the variable arguments.
                      <ul>
                          <li>this will expand out into each argument in the order that it was passed to the macro.</li>
                      </ul>
                  </li>
              </ul>
            </li>
          </ul>
              <p>
                  Using VA macro we can now call <em>DEBUG_MSSG()</em> with as many arguments as we need to handle our <em>fprintf</em> call.
              </p>
              <figure id="va_macro">
<img alt="" border="0" data-original-height="400" data-original-width="860" width="640" src="./img/ex7.png"/>
                  <figcaption>macros with variable arguments. <a rel="external" target="_blank" href="https://github.com/lackluster-games/cpp/blob/master/example7.c">code</a></figcaption>
              </figure>
      </section>
      <section id="standalone">
        <br>
          <header>
              <h2>Using the CPP by itself</h2>
          </header>
          <p>
            The CPP can be used as a standalone macro processor.<br>
            It is very limited in its functionality in this respect compared to a dedicated general purpose macro processor like <a rel="external" target="_blank" href="https://www.gnu.org/software/m4/m4.html">m4</a>. <br>
            But still, it can be put to some use.<br>
            Some reasons to use it as a standalone preprocessor:
          </p>
          <ul>
              <li>Debug your macros
                <ul>
                  <li>you can view how your macros expand out so you can check for errors.</li>
                </ul>
            </li>
              <li>learn more about macros
              <ul>
                <li>viewing how the CPP expands macros can help you learn about macro expansion.</li>
                </ul>
            </li>
                <li>general macro processor
                  <ul>
                    <li>Use it in place of a dedicated general purpose macro processor.</li>
                  </ul>
            </li>
          </ul>
          <p>
              There are a few ways to call the CPP by itself.<br>
              On a GNU/Linux system i know of three ways:
          </p>
          <ul>
              <li>
                  <code>CPP <em>file</em></code>
                  <ul>
                      <li>process <em>file</em> and prints result to stdout.</li>
                  </ul>
              </li>
              <li>
                  <code>gcc -E <em>file</em></code>
                  <ul>
                      <li>tells gcc to compile <em>file</em> but to stop after it runs the preprocessor.</li>
                  </ul>
              </li>
              <li>
                  <code>clang -E <em>file</em></code>
                  <ul>
                      <li>tell clang to compile <em>file</em> but to stop after running the preprocessor.</li>
                  </ul>
              </li>
          </ul>
          <p>
            When using the CPP by itself, I recommend using the flags
          </p>
          <ul>
              <li><code>-P</code>
                  <ul>
                    <li>This will stop the CPP from generating <em>linemarkers</em>.</li>
                  </ul>
              </li>
              <li><code>-C</code>
                  <ul>
                      <li>this will keep comments. Normally CPP removes comments from files.</li>
                  </ul>
              </li>
            </ul>
        <br>
          <header id="comparison">
              <h3>Comparing .c files to output of CPP</h3>
          </header>
          <p>
            Below you can see the output of example1.c after running it through CPP.<br> 
            You can see how the CPP expands the macros <em>PI</em> and <em>str</em>.<br>
            Compare this to the file <em>example1.c</em> to see how the CPP alters it. 
          </p>
          <figure id="output">
<img alt="" border="0" data-original-height="174" data-original-width="613" src="./img/output.png"/>
              <figcaption>output of CPP on example1.c</figcaption>
          </figure>
        <br>
          <header id="htmltags">
              <h3>Using CPP as genreal purpose macro expander</h3>
          </header>
          <p>
            In this example I use the CPP to exand macros into html tags.<br>
            This illustrates an example of how it can be used as a general purpose macro expander.<br>
            It also illustrates the weakness of using the CPP as such.<br>
            The CPP is designed for C code, when you try to use non standard C code with it, you can run into issues.
          </p>
          <figure id="html_tags">
<img alt="" border="0" data-original-height="288" data-original-width="788" width="640" src="./img/ex8.png"/>
              <figcaption>using CPP to expand macros into html tags. <a rel="external" target="_blank" href="https://github.com/lackluster-games/cpp/blob/master/example8.c">code</a></figcaption>
          </figure>
          <figure id="standalone_cpp">
              <figcaption>using the CPP for html tags</figcaption>
          </figure>
          <p>
              Run the CPP on this file and saving it as an <em>.html</em> file.<br>
              Inspecting the file reveals it to generate a valid html file. all macros expand properly.
          </p> 
          <figure id="html_file">
<img alt="" border="0" data-original-height="32" data-original-width="1100" width="640" src="./img/html.png"/>
              <figcaption>html file generated by the CPP. <a rel="external" target="_blank" href="https://github.com/lackluster-games/cpp/blob/master/ex.html">code</a></figcaption>
          </figure>
          <p>
              You can then open the saved .html file in a browser to verify that it works.<br>
              So  you see, it can be done, it's just not the best tool for the job.
          </p>
          <figure id="html_site">
<img alt="" border="0" data-original-height="201" data-original-width="245" src="./img/website.png"/>
              <figcaption>opening the html file in a browser</figcaption>
          </figure>
      </section>
        <br>
      <section id="final">
          <header>
              <h2>Final remarks</h2>
          </header>
          <p>
            The CPP provides some neat functionality to C programming.<br>
            In this post I have show the basics of its use when doing C programming, but also how it can be by itself.<br>
            To go further, I recommend you read the guide on the GCC preprocessor <a id="manual" rel="external" target="_blank" href="https://gcc.gnu.org/onlinedocs/cpp/index.html#SEC_Contents">here.</a><br>
            All example code featured here can be found on <a id="github" rel="external" target="_blank" href="https://github.com/lackluster-games/cpp">github.</a>
              <br>
          </p>
      </section>
	</div>
  <!--side bar -->
  <aside id="Sidebar" class="Sidebar">
  <div id="Tags" class="Tags">
	  <div class="Tags_Header">
	   <header id="Tags_header">
		<h3>Tags</h3>
	  </header>
	</div>
	<!-- List of tags for articles -->
	<div class="Tags_List">
	  <ul id="Tag_list">
		  <li><a href="./pages/tags/c.html">C</a></li>
	  </ul>
	</div> 
	<!-- About me section -->
	<div id="about" class="About">
		<header id="about_me">
			<h3>About me</h3>
		</header>
		<p>Amatuer programmer.Interests include C, Lua, game dev, and free software.</p>
	</div>
	<!-- Contact me section -->
	<div id="contact" class="Contact">
		<header id="contact_me">
			<h3>Contact Me</h3>
		</header>
		<a id="email" target="_blank" href="mailto:armoredmoose@gmail.com">Email Me</a>
		<a id ="github" target="_blank" rel="external" href="https://www.github.com/return5">Github</a>
	</div>
  </div>
  </aside>
  </main>
</html>

